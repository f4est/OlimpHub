{% extends 'base.html' %}
{% block content %}
<nav aria-label="breadcrumb" class="mb-4">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{% url 'index' %}" class="text-decoration-none">Главная</a></li>
    <li class="breadcrumb-item"><a href="{% url 'olymp_detail' olymp.pk %}" class="text-decoration-none">{{ olymp.title }}</a></li>
    <li class="breadcrumb-item active">Таблица результатов</li>
  </ol>
</nav>

<div class="card border-0 shadow-sm mb-4">
  <div class="card-body p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="fw-bold mb-0">
        <i class="bi bi-trophy me-2 text-warning"></i>Таблица результатов
      </h2>
      
      <a href="{% url 'tasks' olymp.pk %}" class="btn btn-outline-primary">
        <i class="bi bi-collection-play me-1"></i>К заданиям
      </a>
    </div>
    
    <h5 class="mb-4">{{ olymp.title }}</h5>
    
    {% if results %}
      <div class="table-responsive scoreboard-table">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th class="text-center" width="70">#</th>
              <th>Участник</th>
              {% for p in problems %}
                <th class="text-center">{{ p.title|truncatechars:8 }}</th>
              {% endfor %}
              <th class="text-center">Всего</th>
            </tr>
          </thead>
  <tbody>
  {% for r in results %}
              <tr {% if r.user == request.user.username %}class="table-primary"{% endif %}>
                <td class="text-center fw-semibold">
                  {% if forloop.counter <= 3 %}
                    {% if forloop.counter == 1 %}
                      <i class="bi bi-trophy-fill text-warning fs-5"></i>
                    {% elif forloop.counter == 2 %}
                      <i class="bi bi-trophy-fill text-secondary fs-5"></i>
                    {% else %}
                      <i class="bi bi-trophy-fill text-danger fs-5"></i>
                    {% endif %}
                  {% else %}
                    {{ forloop.counter }}
                  {% endif %}
                </td>
                <td class="fw-medium">{{ r.user }}</td>
                
                {% for score in r.problem_scores %}
                  <td class="text-center">
                    {% if score > 0 %}
                      <span class="badge bg-success rounded-pill">{{ score }}</span>
                    {% elif score == 0 %}
                      <span class="text-muted">–</span>
                    {% endif %}
                  </td>
                {% endfor %}
                
                <td class="text-center fw-semibold">{{ r.total }}</td>
              </tr>
  {% endfor %}
  </tbody>
</table>
      </div>
    {% else %}
      <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>Пока нет результатов для отображения.
      </div>
    {% endif %}
  </div>
</div>

{% if olymp.status == 'active' %}
<div class="alert alert-warning">
  <div class="d-flex">
    <div class="me-3 fs-3"><i class="bi bi-exclamation-triangle"></i></div>
    <div>
      <h5 class="alert-heading">Соревнование продолжается!</h5>
      <p class="mb-0">Таблица результатов обновляется в реальном времени. Окончательные результаты будут доступны после завершения соревнования.</p>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
