{% extends "admin/base.html" %}
{% load i18n static %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}OlimpHub Администратор{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<style>
    :root {
        --primary: #0066ff;
        --secondary: #53b1fd;
        --accent: #ff6b00;
        --success: #12b76a;
        --dark: #101828;
        --light-bg: #f8f9fc;
        --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        
        /* Цвета текста */
        --text-primary: #212529;
        --text-secondary: #495057;
        --text-light: #ffffff;
        --text-muted: #6c757d;
        
        /* Цвета ссылок */
        --link-color: #0066ff;
        --link-hover: #0052cc;
        
        /* Элементы интерфейса */
        --border-radius: 0.5rem;
        --box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        --border-color: #e9ecef;
        --input-border: #ced4da;
    }

    /* Фикс для скролла - обязательные правила */
    html, body {
        height: auto;
        min-height: 100%;
        overflow-y: auto !important;
    }

    #container {
        overflow: visible !important;
        height: auto !important;
        min-height: 100% !important;
    }

    #content {
        overflow: visible !important;
        height: auto !important;
    }

    .content-wrapper {
        overflow: visible !important;
        height: auto !important;
    }

    body {
        background-color: var(--light-bg);
        color: var(--text-primary);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* Header */
    #header {
        background: var(--dark);
        color: var(--text-light);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 10px 40px;
    }

    #branding h1 {
        font-weight: bold;
        font-size: 1.3rem;
        margin: 0;
        padding: 5px 0;
    }
    
    #branding h1 a {
        color: var(--text-light);
        text-decoration: none;
    }
    
    .admin-subtitle {
        font-size: 0.75em;
        opacity: 0.8;
        margin-left: 5px;
        font-weight: normal;
    }

    /* User tools */
    #user-tools {
        font-size: 0.85rem;
        margin-top: 5px;
    }
    
    #user-tools a, #user-tools button {
        border: none;
        color: rgba(255, 255, 255, 0.9);
        border-radius: var(--border-radius);
        padding: 5px 10px;
        transition: all 0.2s;
        background: none;
        font-family: inherit;
        font-size: inherit;
        cursor: pointer;
        text-decoration: none;
    }
    
    #user-tools a:hover, #user-tools button:hover {
        color: white;
        background-color: rgba(255, 255, 255, 0.2);
    }
    
    #logout-form {
        display: inline-block;
    }
    
    #logout-form button {
        color: #f8d7da;
        background-color: rgba(220, 53, 69, 0.3);
    }
    
    #logout-form button:hover {
        background-color: rgba(220, 53, 69, 0.4);
    }

    /* Breadcrumbs */
    div.breadcrumbs {
        background: white;
        border: none;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-secondary);
        padding: 15px 40px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03);
    }
    
    div.breadcrumbs a {
        color: var(--link-color);
    }
    
    div.breadcrumbs a:hover {
        color: var(--link-hover);
    }

    /* Modules */
    .module {
        border: none;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        margin-bottom: 25px;
        background-color: white;
        overflow: hidden;
    }
    
    .module h2, .module caption {
        background: white;
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1rem;
        border-bottom: 1px solid var(--border-color);
        border-radius: var(--border-radius) var(--border-radius) 0 0;
        padding: 12px 15px;
    }

    /* Content */
    #content {
        padding: 25px 40px;
        width: auto !important;
        max-width: none !important;
    }
    
    #content-main {
        margin-top: 20px;
    }
    
    /* Dashboard */
    .app-olympiad .model-olympiad th {
        width: auto;
    }
    
    /* Forms */
    .button, input[type=submit], input[type=button], .submit-row input, a.button {
        background: var(--primary);
        padding: 10px 15px;
        border-radius: var(--border-radius);
        color: var(--text-light);
        border: none;
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .button:hover, input[type=submit]:hover, input[type=button]:hover, 
    .submit-row input:hover, a.button:hover {
        background: var(--link-hover);
        transform: translateY(-1px);
        color: var(--text-light);
    }
    
    .button.default, input[type=submit].default, .submit-row input.default {
        background: var(--primary);
        font-weight: bold;
        box-shadow: 0 3px 8px rgba(0, 102, 255, 0.2);
        color: var(--text-light);
    }
    
    .button.default:hover, input[type=submit].default:hover, .submit-row input.default:hover {
        background: var(--link-hover);
        box-shadow: 0 5px 12px rgba(0, 102, 255, 0.3);
        color: var(--text-light);
    }
    
    /* Tables */
    table {
        border-radius: var(--border-radius);
        overflow: hidden;
    }
    
    thead th {
        background: #f9fafb;
        color: var(--text-primary);
        font-weight: 600;
    }
    
    td, th {
        padding: 12px;
    }
    
    /* Улучшение отступов в таблицах моделей и результатах */
    table td, 
    table th, 
    .model-list td,
    .model-list th,
    .results table td,
    .results table th,
    #result_list td,
    #result_list th,
    .app-item table td,
    .app-item table th,
    .module table td,
    .module table th,
    .dashboard table td,
    .dashboard table th,
    #content-related table td,
    #content-related table th,
    .app-content table td,
    .app-content table th,
    .change-list table td,
    .change-list table th,
    .inline-group table td,
    .inline-group table th,
    .tabular table td,
    .tabular table th,
    #changelist-form td,
    #changelist-form th,
    .model-list td a,
    .model-list td, 
    .model-list th,
    [class^="table"] td, 
    [class^="table"] th {
        padding-left: 24px !important;
        text-align: left !important;
        vertical-align: middle !important;
    }

    /* Стиль для ячеек таблиц с действиями */
    table td a, table th a,
    .model-list td a, .model-list th a {
        padding: 8px !important;
        display: inline-block !important;
    }

    /* Отступы внутри ссылок */
    td a, th a {
        padding-left: 2px !important;
    }

    /* Выравнивание заголовков */
    .module caption, .module h2,
    .app-item .app-header, 
    .app-content .model-list th {
        padding-left: 20px !important;
        text-align: left !important;
    }

    /* Стиль для текста в таблицах */
    .model-list td,
    .results table td,
    td {
        font-size: 14px !important;
    }
    
    /* Links */
    a:link, a:visited {
        color: var(--link-color);
        transition: color 0.2s;
        text-decoration: none;
    }
    
    a:hover {
        color: var(--link-hover);
    }
    
    /* Messages */
    ul.messagelist li {
        padding: 12px 15px;
        margin: 0 0 10px 0;
        border-radius: var(--border-radius);
        font-weight: 500;
    }
    
    ul.messagelist li.success {
        background: #ecfdf3;
        color: var(--success);
    }
    
    ul.messagelist li.error {
        background: #fef2f2;
        color: #dc3545;
    }
    
    /* Nav Sidebar - Исправлена */
    .dashboard #content {
        width: auto !important;
        max-width: none !important;
    }
    
    .dashboard .module table td a {
        padding: 12px;
    }
    
    #nav-sidebar {
        background: white;
        border-right: 1px solid var(--border-color);
        width: 280px;
    }
    
    #nav-sidebar .section:link, #nav-sidebar .section:visited {
        color: var(--text-primary);
        font-weight: 600;
    }
    
    #nav-sidebar .nav-item-label {
        padding: 12px 10px 12px 12px;
    }
    
    /* Исправляем цвет и отступы для пунктов левого меню */
    #nav-sidebar .nav-item a {
        color: var(--text-primary);
        padding: 10px 15px 10px 25px;
    }
    
    #nav-sidebar .nav-item a:hover, #nav-sidebar .nav-item a:focus {
        background-color: #f1f7ff;
        color: var(--primary);
    }
    
    /* Исправление для текущего элемента */
    #nav-sidebar .current-model a, #nav-sidebar .current-app a {
        color: var(--primary) !important;
        font-weight: 500;
    }
    
    #nav-sidebar .current-model {
        background: #eff8ff;
    }
    
    #nav-sidebar .current-app .section:link, 
    #nav-sidebar .current-app .section:visited {
        color: var(--primary);
    }
    
    .toggle-nav-sidebar {
        border-top: none;
        border-bottom: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: #f9fafb;
        margin: 20px;
    }
    
    /* Форма фильтра справа */
    #changelist-filter h2 {
        background: var(--primary);
        color: white;
    }
    
    #changelist-filter li.selected {
        border-left: 4px solid var(--primary);
    }
    
    /* Действия */
    .actions {
        padding: 15px;
        background: white;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
    }
    
    .actions select {
        padding: 5px 10px;
        border-radius: 5px;
        border: 1px solid var(--border-color);
    }
    
    .actions .button {
        padding: 5px 15px;
    }
    
    /* Dashboard stats */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        padding: 20px;
        text-align: center;
    }
    
    .stat-icon {
        font-size: 2.5rem;
        color: var(--primary);
        margin-bottom: 10px;
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: var(--text-secondary);
        font-weight: 500;
    }
    
    /* Remove theme toggle button */
    .theme-toggle {
        display: none !important;
    }
    
    /* Исправляем ширину панели изменения */
    .layout-fixed {
        max-width: none !important;
    }
    
    .aligned .form-row, form .aligned p {
        padding: 15px 0;
    }
    
    .submit-row {
        background: white;
        border-radius: var(--border-radius);
        padding: 15px;
    }
    
    /* Улучшаем поля формы */
    input, textarea, select {
        padding: 8px 12px;
        border-radius: 5px;
        border: 1px solid var(--input-border);
    }
    
    .inline-group {
        background: white;
        border-radius: var(--border-radius);
        padding: 10px;
        margin-bottom: 20px;
    }
    
    /* Статистика для страниц приложений */
    .app-stats-container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 25px;
    }
    
    .app-stat-card {
        flex: 1;
        min-width: 150px;
        max-width: 250px;
        background: white;
        padding: 15px;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        text-align: center;
    }
    
    .app-stat-icon {
        display: inline-flex;
        width: 50px;
        height: 50px;
        background: rgba(0, 102, 255, 0.1);
        border-radius: 50%;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
        font-size: 1.5rem;
        color: var(--primary);
    }
    
    .app-stat-value {
        font-size: 1.6rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 5px;
    }
    
    .app-stat-label {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    /* Улучшаем дизайн таблиц на страницах списка объектов */
    #changelist table,
    .change-list table,
    #changelist-form .results,
    .results table {
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--box-shadow);
        border: none !important;
    }

    /* Заголовки таблиц */
    #changelist table thead th,
    .change-list table thead th {
        background-color: #f8fafd !important;
        font-weight: 600 !important;
        color: var(--text-primary) !important;
        border-bottom: 1px solid var(--border-color) !important;
        padding: 15px 20px !important;
        font-size: 0.9rem !important;
    }

    /* Ячейки таблиц */
    #changelist table tbody td,
    .change-list table tbody td,
    #result_list td,
    #result_list th {
        padding: 15px 20px !important;
        border-bottom: 1px solid var(--border-color) !important;
        vertical-align: middle !important;
        font-size: 0.95rem !important;
        background-color: white !important;
        color: var(--text-primary) !important;
    }

    /* Ссылки в таблицах */
    #changelist table a,
    .change-list table a {
        color: var(--primary) !important;
        text-decoration: none !important;
        transition: color 0.2s !important;
        font-weight: 500 !important;
    }

    #changelist table a:hover,
    .change-list table a:hover {
        color: var(--link-hover) !important;
    }

    /* Полосатые строки */
    #changelist table tbody tr:nth-child(odd) td,
    .change-list table tbody tr:nth-child(odd) td {
        background-color: #fcfcfe !important;
    }

    /* Эффект при наведении на строку */
    #changelist table tbody tr:hover td,
    .change-list table tbody tr:hover td {
        background-color: #f5f8ff !important;
    }

    /* Улучшаем дизайн боковых фильтров */
    #changelist-filter {
        background-color: white !important;
        border-radius: var(--border-radius) !important;
        box-shadow: var(--box-shadow) !important;
        margin-left: 20px !important;
        padding-bottom: 15px !important;
    }

    #changelist-filter h2 {
        border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
        padding: 15px 20px !important;
        background-color: var(--primary) !important;
        color: white !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
    }

    #changelist-filter h3 {
        padding: 15px 20px 8px !important;
        margin: 0 !important;
        font-size: 0.9rem !important;
        font-weight: 600 !important;
        color: var(--text-primary) !important;
    }

    #changelist-filter ul {
        padding: 0 5px !important;
        margin: 0 !important;
    }

    #changelist-filter li {
        padding: 5px 15px !important;
        margin: 0 !important;
        list-style-type: none !important;
    }

    #changelist-filter li a {
        color: var(--link-color) !important;
        text-decoration: none !important;
    }

    #changelist-filter li.selected {
        border-left: 3px solid var(--primary) !important;
        padding-left: 12px !important;
        background-color: #f8fafd !important;
    }

    #changelist-filter li.selected a {
        color: var(--primary) !important;
        font-weight: 500 !important;
    }

    /* Улучшаем отображение элементов управления */
    .paginator, .submit-row {
        background-color: white !important;
        border-radius: var(--border-radius) !important;
        box-shadow: var(--box-shadow) !important;
        padding: 15px 20px !important;
        border: none !important;
    }

    /* Статусные иконки (зеленый/красный индикатор) */
    .paginator .this-page, 
    td .true, 
    th .true,
    img[src$="icon-yes.svg"],
    .true img {
        color: white !important;
        background-color: #10b981 !important;
        border-radius: 50% !important;
        width: 20px !important;
        height: 20px !important;
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-size: 0 !important;
    }

    td .true:before, 
    th .true:before,
    img[src$="icon-yes.svg"]:before,
    .true img:before {
        content: "✓" !important;
        font-size: 13px !important;
        color: white !important;
    }

    td .false, 
    th .false,
    img[src$="icon-no.svg"],
    .false img {
        color: white !important;
        background-color: #ef4444 !important;
        border-radius: 50% !important;
        width: 20px !important;
        height: 20px !important;
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-size: 0 !important;
    }

    td .false:before, 
    th .false:before,
    img[src$="icon-no.svg"]:before,
    .false img:before {
        content: "×" !important;
        font-size: 13px !important;
        color: white !important;
    }

    /* Левое меню - заменяем темные фоны на светлые */
    .app-auth, .app-olympiad, .app-submissions,
    .dashboard .module tr, .dashboard .module th,
    #nav-sidebar a, #nav-sidebar .section,
    #nav-sidebar, .dashboard .app {
        background-color: white !important;
        color: var(--text-primary) !important;
    }

    /* Стили для блоков в левой панели */
    .dashboard .app, .dashboard .module {
        background-color: white !important;
        border-radius: var(--border-radius) !important;
        box-shadow: var(--box-shadow) !important;
        border: none !important;
        margin-bottom: 15px !important;
    }

    /* Заголовки модулей в левой панели */
    .dashboard .module caption, 
    .dashboard .module h2 {
        background-color: #f8fafd !important;
        color: var(--text-primary) !important;
        font-weight: 600 !important;
        border-bottom: 1px solid var(--border-color) !important;
    }

    /* Пункты меню в левой панели */
    #nav-sidebar .module th,
    .dashboard .module th,
    .dashboard .module tr,
    .dashboard .module td {
        background-color: white !important;
        border-bottom: 1px solid var(--border-color) !important;
    }

    /* Ссылки в левой панели */
    #nav-sidebar a, 
    .dashboard .module a {
        color: var(--link-color) !important;
        text-decoration: none !important;
        transition: background-color 0.2s !important;
        display: block !important;
        padding: 10px 15px !important;
    }

    /* Эффект при наведении на пункт меню */
    #nav-sidebar a:hover, 
    .dashboard .module a:hover {
        background-color: #f5f8ff !important;
        color: var(--primary) !important;
    }

    /* Активный пункт меню */
    #nav-sidebar .current-app a, 
    #nav-sidebar .current-model a {
        background-color: #eff8ff !important;
        color: var(--primary) !important;
        font-weight: 500 !important;
    }

    /* Логотип и заголовок в шапке */
    #branding h1 {
        color: white !important;
    }

    /* Отдельные стили для основных разделов меню */
    .app-olympiad .module th,
    .app-auth .module th,
    .app-submissions .module th {
        background-color: #f8fafd !important;
        color: var(--text-primary) !important;
        font-weight: 600 !important;
        font-size: 0.9rem !important;
        padding: 12px 15px !important;
    }

    /* Полноценное обновление стилей для основных элементов левой навигации */
    .module h2, .app-item .app-header, .model-group h2 {
        background-color: #f8fafd !important;
        color: var(--text-primary) !important;
        border-bottom: 1px solid var(--border-color) !important;
    }

    /* Исправления для фона строк в левой панели с элементами */
    tr.model-user, tr.model-group, tr.model-olympiad, tr.model-problem, tr.model-userprofile, tr.model-submission,
    .app-olympiad tr, .app-auth tr, .app-submissions tr {
        background-color: white !important;
    }

    /* Исправляем поле поиска в левой панели */
    input[type="text"], .sidebar-wrapper input {
        background-color: white !important;
        border: 1px solid var(--border-color) !important;
        border-radius: 4px !important;
        padding: 8px 12px !important;
        color: var(--text-primary) !important;
    }

    /* Поле "Start typing to filter..." */
    #nav-filter input {
        background-color: white !important;
        border: 1px solid var(--border-color) !important;
        color: var(--text-primary) !important;
    }

    /* Стили для блоков с моделями в левой панели */
    .app-item, 
    .app-olympiad,
    .app-auth,
    .app-submissions,
    .model-group,
    .model-user,
    .model-olympiad, 
    .model-problem, 
    .model-userprofile,
    .model-submission {
        background-color: white !important;
        border-radius: var(--border-radius) !important;
        box-shadow: var(--box-shadow) !important;
        margin-bottom: 10px !important;
        overflow: hidden !important;
        border: 1px solid var(--border-color) !important;
    }

    /* Сами таблицы и их ячейки */
    .app-olympiad table,
    .app-auth table,
    .app-submissions table,
    .model-group table,
    .model-user table,
    .model-olympiad table,
    .model-problem table,
    .model-userprofile table,
    .model-submission table {
        background-color: white !important;
        border-collapse: collapse !important;
        width: 100% !important;
    }

    /* Заголовки в боковых таблицах */
    .app-olympiad th,
    .app-auth th,
    .app-submissions th,
    .model-group th,
    .model-user th,
    .model-olympiad th,
    .model-problem th,
    .model-userprofile th,
    .model-submission th {
        background-color: #f8fafd !important;
        color: var(--text-primary) !important;
        font-weight: 600 !important;
        border-bottom: 1px solid var(--border-color) !important;
        padding: 12px 15px !important;
        text-align: left !important;
    }

    /* Ячейки таблиц в боковой панели */
    .app-olympiad td,
    .app-auth td,
    .app-submissions td,
    .model-group td,
    .model-user td,
    .model-olympiad td,
    .model-problem td,
    .model-userprofile td,
    .model-submission td {
        background-color: white !important;
        border-bottom: 1px solid var(--border-color) !important;
        padding: 10px 15px !important;
    }

    /* Ссылки в таблицах */
    .app-olympiad a,
    .app-auth a,
    .app-submissions a,
    .model-group a,
    .model-user a,
    .model-olympiad a,
    .model-problem a,
    .model-userprofile a,
    .model-submission a {
        color: var(--primary) !important;
        text-decoration: none !important;
        font-weight: 500 !important;
        transition: color 0.2s !important;
        display: inline-block !important;
        padding: 5px 0 !important;
    }

    .app-olympiad a:hover,
    .app-auth a:hover,
    .app-submissions a:hover,
    .model-group a:hover,
    .model-user a:hover,
    .model-olympiad a:hover,
    .model-problem a:hover,
    .model-userprofile a:hover,
    .model-submission a:hover {
        color: var(--link-hover) !important;
    }

    /* Специальные стили для конкретных элементов боковой панели */
    .sidebar-wrapper, 
    #nav-sidebar,
    .app-app.module,
    #nav-filter {
        background-color: var(--light-bg) !important;
    }

    /* Иконки + и ▸ в боковой панели */
    .addlink, .changelink {
        color: var(--primary) !important;
    }

    /* Фиксим таблицы на главной странице admin */
    .dashboard .module table,
    .dashboard .app-item table {
        background-color: white !important;
        width: 100% !important;
    }

    /* Фиксим конкретные классы для моделей на главной странице */
    .app-auth .module,
    .app-olympiad .module,
    .app-submissions .module,
    #content-related .module {
        background-color: white !important;
        border-radius: var(--border-radius) !important;
        box-shadow: var(--box-shadow) !important;
    }

    /* Фиксим темный фон у кнопки add в моделях */
    div.object-tools a,
    .object-tools a.addlink {
        background-color: var(--primary) !important;
        color: white !important;
        border-radius: var(--border-radius) !important;
        padding: 6px 12px !important;
        text-decoration: none !important;
    }

    /* Исправляем конкретные элементы из скриншота */
    tr.model-group, 
    tr.model-user,
    tr.model-olympiad,
    tr.model-problem,
    tr.model-userprofile,
    tr.model-submission,
    #nav-sidebar .model-group,
    #nav-sidebar .model-user,
    #nav-sidebar .model-olympiad,
    #nav-sidebar .model-problem,
    #nav-sidebar .model-userprofile,
    #nav-sidebar .model-submission {
        background-color: white !important;
    }

    /* Общий фикс для всех оставшихся темных элементов в админке */
    .sidebar-wrapper tr,
    .content-wrapper tr,
    .admin-panel tr,
    .admin-interface tr,
    .dashboard tr,
    .nav-item,
    .module tr,
    .app-item,
    .results tr,
    .change-list tr,
    .object-tools,
    .breadcrumbs + * tr,
    #content tr,
    #nav-sidebar tr,
    #changelist tr,
    .pagination tr,
    [class*="model-"] tr,
    [class*="app-"] tr,
    [id*="changelist"] tr {
        background-color: white !important;
    }

    /* Исправление для вложенных таблиц и модулей */
    table table,
    .module .module,
    .module table,
    .module tr,
    .module th,
    .module td {
        background-color: white !important;
    }

    /* Исправление для различных блоков и контейнеров */
    .object-tools,
    .breadcrumbs + div,
    .content-wrapper > div,
    #changelist-form,
    #changelist-filter,
    .actions,
    .paginator,
    .submit-row,
    .form-row,
    fieldset,
    .fieldset,
    .inline-group,
    .inline-related,
    .selector-available,
    .selector-chosen,
    #toolbar,
    #changelist-search,
    .related-widget-wrapper,
    .dashboard .module {
        background-color: white !important;
    }

    /* Специальный фикс для заголовков модулей */
    .module h2, 
    .module caption, 
    .module th,
    .app-item .app-header,
    .dashboard .module h2,
    .dashboard .module caption,
    .dashboard .module th {
        background-color: #f8fafd !important;
        color: var(--text-primary) !important;
    }

    /* Исправление для боковой панели и ее элементов */
    #nav-sidebar,
    #nav-sidebar .module,
    #nav-sidebar .section,
    #nav-sidebar .section:link,
    #nav-sidebar .section:visited,
    #nav-sidebar a,
    #nav-sidebar a:link,
    #nav-sidebar a:visited,
    .sidebar-wrapper,
    .sidebar-wrapper div,
    .sidebar-wrapper input,
    .nav-sidebar,
    .nav-sidebar a {
        background-color: var(--light-bg) !important;
        color: var(--text-primary) !important;
    }

    /* Исправление для боковой панели - оставляем белый фон для подчиненных элементов */
    #nav-sidebar .children,
    #nav-sidebar .children a,
    #nav-sidebar .children div {
        background-color: white !important;
    }

    /* Фикс для поля поиска в верхней части страниц списка */
    .search-container,
    #searchbar,
    #searchbar input,
    #searchbar button,
    #toolbar form input,
    #toolbar form select,
    #changelist-search input,
    #changelist-search select,
    #changelist-search button {
        background-color: white !important;
        border: 1px solid var(--border-color) !important;
        color: var(--text-primary) !important;
    }

    /* Исправление для ссылок в навигации, чтобы они всегда были видны */
    #nav-sidebar a,
    .module a,
    .app-item a {
        color: var(--link-color) !important;
    }

    /* Фикс для полей ввода и форм */
    input, textarea, select, button {
        background-color: white !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border-color) !important;
    }

    /* Исключения для кнопок действий, чтобы они сохраняли свой дизайн */
    .button, input[type=submit], input[type=button], .submit-row input, a.button {
        background: var(--primary) !important;
        color: var(--text-light) !important;
        border: none !important;
    }

    /* Фикс конкретных элементов, которые могут остаться темными */
    tr.model-groups, 
    tr.model-users,
    tr.model-olympiads,
    tr.model-problems,
    tr.model-userprofiles,
    tr.model-submissions,
    .model-groups,
    .model-users,
    .model-olympiads,
    .model-problems,
    .model-userprofiles,
    .model-submissions,
    .models td,
    .models tr {
        background-color: white !important;
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block branding %}
<h1 id="site-name">
    <a href="{% url 'admin:index' %}">
        <i class="bi bi-trophy-fill me-2 text-warning"></i>OlimpHub <span class="admin-subtitle">Административная панель</span>
    </a>
</h1>
{% endblock %}

{% block nav-global %}{% endblock %}

{% block welcome-msg %}
    <strong>{{ user.get_username }}</strong>
{% endblock %}

{% block userlinks %}
    <a href="/" title="Вернуться на сайт">
        <i class="bi bi-house-door me-1"></i>На сайт
    </a> /
    <a href="{% url 'admin:password_change' %}" title="Изменить пароль">
        <i class="bi bi-key me-1"></i>Сменить пароль
    </a> /
    <form id="logout-form" method="post" action="{% url 'admin:logout' %}">
        {% csrf_token %}
        <button type="submit" title="Выйти из системы">
            <i class="bi bi-box-arrow-right me-1"></i>Выйти
        </button>
    </form>
{% endblock %}

{% block content %}
{{ block.super }}

{% if request.path != '/admin/' and not is_popup %}
<script>
// Загрузка статистики для страниц приложений
document.addEventListener('DOMContentLoaded', function() {
    // Находим элемент, перед которым будем вставлять статистику
    let insertBeforeElement;
    
    // Попробуем найти различные элементы в зависимости от типа страницы
    const contentMain = document.getElementById('content-main');
    const changeList = document.querySelector('.change-list');
    const moduleTable = document.querySelector('.module table');
    const appList = document.querySelector('.app-list');
    const results = document.querySelector('#changelist-form') || document.querySelector('.results');
    
    // Определяем, перед каким элементом вставлять статистику
    if (contentMain && contentMain.firstChild) {
        insertBeforeElement = contentMain.firstChild;
    } else if (changeList) {
        insertBeforeElement = changeList;
    } else if (results) {
        insertBeforeElement = results;
    } else if (moduleTable) {
        insertBeforeElement = moduleTable.parentNode;
    } else if (appList) {
        insertBeforeElement = appList;
    } else {
        // Если не нашли подходящий элемент, попробуем найти любой контейнер
        const container = document.querySelector('#content') || document.querySelector('body');
        if (container && container.firstChild) {
            insertBeforeElement = container.firstChild;
        }
    }
    
    // Если нашли элемент для вставки
    if (insertBeforeElement) {
        // Создаем контейнер для статистики
        const container = document.createElement('div');
        container.className = 'app-stats-container';
        container.style.marginBottom = '30px';
        container.style.backgroundColor = 'transparent';
        
        // Создаем карточки статистики с предустановленными данными
        // Пользователи
        const userCard = document.createElement('div');
        userCard.className = 'app-stat-card';
        userCard.innerHTML = `
            <div class="app-stat-icon" style="background-color: rgba(67, 97, 238, 0.1); color: #4361ee;">👤</div>
            <div class="app-stat-value user-count">0</div>
            <div class="app-stat-label">Пользователей</div>
        `;
        container.appendChild(userCard);
        
        // Соревнования
        const olympiadCard = document.createElement('div');
        olympiadCard.className = 'app-stat-card';
        olympiadCard.innerHTML = `
            <div class="app-stat-icon" style="background-color: rgba(255, 126, 0, 0.1); color: #ff7e00;">🏆</div>
            <div class="app-stat-value olympiad-count">0</div>
            <div class="app-stat-label">Соревнований</div>
        `;
        container.appendChild(olympiadCard);
        
        // Задания
        const problemCard = document.createElement('div');
        problemCard.className = 'app-stat-card';
        problemCard.innerHTML = `
            <div class="app-stat-icon" style="background-color: rgba(6, 214, 160, 0.1); color: #06d6a0;">✓</div>
            <div class="app-stat-value problem-count">0</div>
            <div class="app-stat-label">Заданий</div>
        `;
        container.appendChild(problemCard);
        
        // Решения
        const submissionCard = document.createElement('div');
        submissionCard.className = 'app-stat-card';
        submissionCard.innerHTML = `
            <div class="app-stat-icon" style="background-color: rgba(0, 150, 199, 0.1); color: #0096c7;">📝</div>
            <div class="app-stat-value submission-count">0</div>
            <div class="app-stat-label">Решений</div>
        `;
        container.appendChild(submissionCard);
        
        // Вставляем контейнер перед выбранным элементом
        insertBeforeElement.parentNode.insertBefore(container, insertBeforeElement);
        
        // Функция для обновления статистики
        const updateStats = function(data) {
            document.querySelector('.user-count').textContent = data.users_count || 0;
            document.querySelector('.olympiad-count').textContent = data.olympiads_count || 0;
            document.querySelector('.problem-count').textContent = data.problems_count || 0;
            document.querySelector('.submission-count').textContent = data.submissions_count || 0;
        };
        
        // Загружаем статистику
        fetch('/api/dashboard-stats/')
            .then(response => response.json())
            .then(data => {
                updateStats(data);
            })
            .catch(error => {
                console.error('Ошибка при загрузке статистики:', error);
                // Альтернативный метод через XHR
                const xhr = new XMLHttpRequest();
                xhr.open('GET', '/api/dashboard-stats/', true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        try {
                            const data = JSON.parse(xhr.responseText);
                            updateStats(data);
                        } catch(e) {
                            console.error('Ошибка парсинга JSON:', e);
                        }
                    }
                };
                xhr.send();
            });
    }
});
</script>
{% endif %}
{% endblock %} 